> <sup>**NOTE: This README is generated using the knife-cookbook-doc plugin.
> Please do not edit this file directly, instead use the `rake doc` task.**</sup>

# Description

The cookbook provides a resource to install Xcode with the options (default) to install multiple versions, side by side.
This side-by-side installation is especially useful for those that run build farms and need to support multiple Xcode versions.

Installs Xcode on Lion, Mountain Lion, Mavericks, Yosemite, El Capitan, Sierra, High Sierra, and Mojava.

Include `xcode` cookbook in recipe or the node's `run_list` to esnure the `dmg` cookbook is included:
```ruby
include_recipe 'xcode'
```
Or
```json
{
  "name":"my_node",
  "run_list": [
    "recipe[xcode]"
  ]
}
```

# Requirements


Xcode Command Line Tools should already be installed either by `brew` or through [build-essential](https://supermarket.chef.io/cookbooks/build-essential).

## Limitations

This does not yet support Xcode packaged with XIP. It is recommended to download and convert to DMG.

The DMGs are not accessible from Apple directly without logging into the developer center,
you must place the DMGs on your own fileserver and list them in a data bag on your Chef server.
## Platform:

* mac_os_x

## Cookbooks:

* dmg

# Recipes

* xcode::default - Includes DMG required by resource


# Attributes
### `node['xcode']`...

<table>
  <tbody>
    <tr>
      <td><em>No attributes defined</em></td>
    </tr>
  </tbody>
</table>

# Resources

* [xcode_app](#xcode_app) - Install Xcode app.
* [xcode_simulator](#xcode_simulator) - Install simulator used by Xcode.

## xcode_app

Install Xcode app.

### Actions

- install: Installs Xcode app to `install_root` Default action.
- remove: Delete directory based on `install_dir`
- uninstall: Deprecated

### Attribute Parameters

- version: Unique string to idenfity installed resource, appended to `install_dir`
- url: Location of DMG to download
- checksum: Checksum of DMG
- app: Used by `dmg_package` Defaults to <code>"\"Xcode\""</code>.
- install_suffix: If not empty, appended to install folder when moved within `install_root` Defaults to <code>"nil"</code>.
- install_root: Root folder where Xcode is installed Defaults to <code>"\"/Applications\""</code>.
- force: Overwrite any existing install location Defaults to <code>"false"</code>.

### Notes
* `/Applications/Xcode.app` will still need to be addressed (ex: symlink an installed version)
* `xcode-select -s <dir>` is run after each install so last verison will be default

### Example
For side-by-side installation, create a data bag item for each version.
The data bag needs to provide the following attributes at the very least:
```json
  "id": "7_3_1",
  "app": "Xcode",
  "url": "YOUR URL HERE",
  "checksum": "bb0dedf613e86ecb46ced945913fa5069ab716a0ade1035e239d70dee0b2de1b",
  "action": "install"
```
Then loop and call `xcode_app`:
```ruby
include_recipe 'xcode'

xcode_versions.each do |version|
  xcode = data_bag_item(node['xcode']['app']['data_bag'], version)
  xcode_app xcode['id'] do
    app xcode['app']
    url xcode['url']
    checksum xcode['checksum']
    action xcode['action']
    install_suffix xcode['id']
    install_root node['xcode']['install_root'] unless node['xcode']['install_root'].nil?
    force xcode['force'] unless xcode['force'].nil?
  end
end
```

## xcode_simulator

Install simulator used by Xcode.
Property `name` is provided by `InstallPrefix` in download index (ex: `/Library/Developer/CoreSimulator/Profiles/Runtimes`)

### Actions

- install: Installs simulator Default action.
- remove: Delete directory based on `install_dir`
- uninstall: Deprecated

### Attribute Parameters

- version: Unique string to identify installed simulator
- url: Location of DMG to download
- checksum: Checksum of DMG
- force: Overwrite any existing install Defaults to <code>"false"</code>.

### Example
For ease of multiple simulators, create a data bag item for each.
The data bag needs to provide the following attributes at the very least:
```json
  "id": "iOS_10_1",
  "version": "10.1.1.1476902849",
  "name": "iOS 10.1",
  "url": "YOUR URL HERE",
  "checksum": "bb0dedf613e86ecb46ced945913fa5069ab716a0ade1035e239d70dee0b2de1b",
  "action": "install"
````
Then loop and call `xcode_simulator`:
```ruby
simulator_versions = data_bag(node['xcode']['sim']['data_bag'])

simulator_versions.each do |version|
  simulator = data_bag_item(node['xcode']['sim']['data_bag'], version)

  xcode_simulator simulator['name'] do
    url simulator['url']
    checksum simulator['checksum']
    action simulator['action']
  end
end
```

<br>

## Notes

When testing, ensure the VM has sufficient space for Xcode & simulators.

### Available Simulators

To see what simulators are available, below is an example Ruby script that can be used to get a list of URLs:
```ruby
require 'json'

xcode_info = '/Applications/Xcode.app/Contents/Info.plist'
xcode_version = `/usr/libexec/PlistBuddy -c "Print :DTXcode" #{xcode_info}`.chomp.to_i.to_s.split(//).join('.')
xcode_uuid = `/usr/libexec/PlistBuddy -c "Print :DVTPlugInCompatibilityUUID" #{xcode_info}`.chomp

if Gem::Version.new(xcode_version) >= Gem::Version.new('8.1')
  index_url = "https://devimages-cdn.apple.com/downloads/xcode/simulators/index-#{xcode_version}-#{xcode_uuid}.dvtdownloadableindex"
else
  index_url = "https://devimages.apple.com.edgekey.net/downloads/xcode/simulators/index-#{xcode_version}-#{xcode_uuid}.dvtdownloadableindex"
end

JSON.parse(`curl -Ls #{index_url} | plutil -convert json -o - -`)['downloadables'].map do |sim|
  sim_version_major = sim['version'].to_s.split('.')[0]
  sim_version_minor = sim['version'].to_s.split('.')[1]

  name = sim['name']
    .sub('$(DOWNLOADABLE_VERSION_MAJOR)', sim_version_major)
    .sub('$(DOWNLOADABLE_VERSION_MINOR)', sim_version_minor)

  identifier = sim['identifier']
    .sub('$(DOWNLOADABLE_VERSION_MAJOR)', sim_version_major)
    .sub('$(DOWNLOADABLE_VERSION_MINOR)', sim_version_minor)

  source = sim['source']
    .sub('$(DOWNLOADABLE_IDENTIFIER)', identifier)
    .sub('$(DOWNLOADABLE_VERSION)', sim['version'])

  puts "#{name} - SDK #{sim['version']} :"
  puts "    #{source}"
end
```

<br>

# Info

## License and Maintainer

Maintainer:: Roblox (<info@roblox.com>)

Source:: https://github.com/Roblox/chef-xcode

Issues:: https://github.com/Roblox/chef-xcode/issues

License:: Apache-2.0

## Credit

* Original cookbook inspiration https://github.com/chef-osx/xcode
  * Originally by Julian C. Dunn (https://github.com/juliandunn)
* Conversion to LWRP Antek Baranski (https://github.com/Sauraus)
* Contributions by Brenton Bartel (https://github.com/Brantone)
